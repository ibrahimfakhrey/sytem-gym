{% extends "base.html" %}
{% block title %}العروض الترويجية{% endblock %}
{% block content %}
<div class="page-header">
    <h1><i class="bi bi-percent"></i> العروض الترويجية {% if active_count > 0 %}<span class="badge bg-success">{{ active_count }} نشط</span>{% endif %}</h1>
    <a href="{{ url_for('offers.create', brand_id=brand.id) }}" class="btn btn-primary"><i class="bi bi-plus-lg"></i> إضافة عرض</a>
</div>
<div class="card">
    <div class="card-body">
        {% if offers %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead><tr><th>اسم العرض</th><th>الخصم</th><th>الفترة</th><th>الاستخدام</th><th>الحالة</th><th>الإجراءات</th></tr></thead>
                <tbody>
                    {% for offer in offers %}
                    <tr>
                        <td><strong>{{ offer.name }}</strong>{% if offer.description %}<br><small class="text-muted">{{ offer.description[:30] }}...</small>{% endif %}</td>
                        <td>{% if offer.discount_type == 'percentage' %}{{ offer.discount_value }}%{% else %}{{ "{:,.0f}".format(offer.discount_value) }} ر.س{% endif %}</td>
                        <td>{{ offer.start_date.strftime('%m/%d') }} - {{ offer.end_date.strftime('%m/%d') }}</td>
                        <td>{{ offer.current_uses }}{% if offer.max_uses %}/{{ offer.max_uses }}{% endif %}</td>
                        <td><span class="badge bg-{{ 'success' if offer.is_active else 'secondary' }}">{{ 'نشط' if offer.is_active else 'متوقف' }}</span></td>
                        <td>
                            <a href="{{ url_for('offers.edit', offer_id=offer.id) }}" class="btn btn-sm btn-outline-primary"><i class="bi bi-pencil"></i></a>
                            <form method="post" action="{{ url_for('offers.toggle', offer_id=offer.id) }}" class="d-inline">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-sm btn-outline-{{ 'warning' if offer.is_active else 'success' }}"><i class="bi bi-{{ 'pause' if offer.is_active else 'play' }}"></i></button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5"><i class="bi bi-percent display-1 text-muted"></i><h4 class="mt-3">لا توجد عروض</h4></div>
        {% endif %}
    </div>
</div>
{% endblock %}
