{% extends "base.html" %}

{% block title %}تسجيل حضور الموظفين{% endblock %}

{% block content %}
<div class="page-header">
    <h1>
        <i class="bi bi-calendar-check"></i>
        تسجيل حضور الموظفين
    </h1>
    <a href="{{ url_for('employees.report', brand_id=brand.id if brand else '') }}" class="btn btn-outline-primary">
        <i class="bi bi-bar-chart"></i>
        تقرير الموظفين
    </a>
</div>

<div class="row">
    <!-- Add Attendance Form -->
    <div class="col-lg-5">
        <div class="card mb-4">
            <div class="card-header">
                <i class="bi bi-plus-lg"></i>
                تسجيل حضور جديد
            </div>
            <div class="card-body">
                <!-- Brand Selector -->
                {% if brands|length > 1 %}
                <form method="get" class="mb-4">
                    <label class="form-label">البراند</label>
                    <select name="brand_id" class="form-select" onchange="this.form.submit()">
                        {% for b in brands %}
                        <option value="{{ b.id }}" {% if brand and b.id == brand.id %}selected{% endif %}>
                            {{ b.name }}
                        </option>
                        {% endfor %}
                    </select>
                </form>
                {% endif %}

                <form method="POST">
                    {{ form.hidden_tag() }}

                    <div class="mb-3">
                        <label class="form-label">الموظف *</label>
                        {{ form.user_id(class="form-select") }}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">التاريخ *</label>
                        {{ form.date(class="form-control", type="date") }}
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">وقت الحضور *</label>
                            {{ form.check_in(class="form-control", type="time") }}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">وقت الانصراف</label>
                            {{ form.check_out(class="form-control", type="time") }}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">الحالة</label>
                        {{ form.status(class="form-select") }}
                    </div>

                    <div class="mb-3">
                        <label class="form-label">ملاحظات</label>
                        {{ form.notes(class="form-control", rows="2") }}
                    </div>

                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-check-lg"></i>
                        تسجيل الحضور
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Recent Attendance -->
    <div class="col-lg-7">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-clock-history"></i>
                سجل الحضور الأخير
            </div>
            <div class="card-body">
                {% if recent_attendance %}
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>التاريخ</th>
                                <th>الموظف</th>
                                <th>الحضور</th>
                                <th>الانصراف</th>
                                <th>التأخير</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for att in recent_attendance %}
                            <tr>
                                <td>{{ att.date.strftime('%m-%d') }}</td>
                                <td>
                                    <a href="{{ url_for('employees.details', user_id=att.user_id) }}">
                                        {{ att.employee.name if att.employee else '-' }}
                                    </a>
                                </td>
                                <td>{{ att.check_in.strftime('%H:%M') if att.check_in else '-' }}</td>
                                <td>{{ att.check_out.strftime('%H:%M') if att.check_out else '-' }}</td>
                                <td>
                                    {% if att.late_minutes > 0 %}
                                    <span class="text-warning">{{ att.late_minutes }}د</span>
                                    {% else %}
                                    -
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-{{ att.status_class }}">{{ att.status_text }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="bi bi-calendar-x"></i>
                    <h5>لا يوجد سجل</h5>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
