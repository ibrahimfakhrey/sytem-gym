# خطة برنامج إدارة البصمة للجيم
# Gym Fingerprint Bridge Software Plan

---

## 🎯 نظرة عامة | Overview

برنامج سطح مكتب يعمل كجسر بين جهاز البصمة (AAS) وتطبيق الويب

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         GYM BRIDGE SOFTWARE                              │
│                                                                          │
│  ┌─────────────┐      ┌─────────────┐      ┌─────────────┐             │
│  │   .mdb      │ ←──→ │  SOFTWARE   │ ←──→ │   WEB APP   │             │
│  │  Database   │      │   (Bridge)  │      │  (Cloud)    │             │
│  └─────────────┘      └─────────────┘      └─────────────┘             │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 🎨 التصميم | Design

### الألوان | Colors (Dark Blue Professional Theme)
```
Primary:        #1a237e (Navy Blue)
Secondary:      #303f9f (Indigo)
Accent:         #448aff (Light Blue)
Background:     #0d1421 (Dark Navy)
Card Background:#1a2332 (Darker Blue)
Text Primary:   #ffffff (White)
Text Secondary: #b0bec5 (Gray)
Success:        #4caf50 (Green)
Warning:        #ff9800 (Orange)
Error:          #f44336 (Red)
```

### الواجهة | Interface Layout

```
┌──────────────────────────────────────────────────────────────────────────┐
│  ╔═══════════════════════════════════════════════════════════════════╗  │
│  ║  🏋️ نظام إدارة الجيم                              [─] [□] [X]  ║  │
│  ╚═══════════════════════════════════════════════════════════════════╝  │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │                         حالة الاتصال                                │ │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐              │ │
│  │  │ 🟢 متصل      │  │ 📊 150 عضو   │  │ 🕐 آخر مزامنة │              │ │
│  │  │   بالسيرفر   │  │   مسجل       │  │   منذ 5 ثواني │              │ │
│  │  └──────────────┘  └──────────────┘  └──────────────┘              │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌───────────────────────────┬────────────────────────────────────────┐ │
│  │      القائمة الجانبية      │              المحتوى الرئيسي           │ │
│  │  ┌─────────────────────┐  │  ┌──────────────────────────────────┐  │ │
│  │  │ 🏠 الرئيسية         │  │  │                                  │  │ │
│  │  ├─────────────────────┤  │  │      إضافة عضو جديد              │  │ │
│  │  │ 👥 الأعضاء          │  │  │  ┌────────────────────────────┐  │  │ │
│  │  ├─────────────────────┤  │  │  │ الاسم: [________________]  │  │  │ │
│  │  │ ➕ إضافة عضو        │  │  │  │ الجوال: [_______________]  │  │  │ │
│  │  ├─────────────────────┤  │  │  │ الجنس: [ذكر ▼]            │  │  │ │
│  │  │ 🔄 المزامنة         │  │  │  │ انتهاء الاشتراك: [____]   │  │  │ │
│  │  ├─────────────────────┤  │  │  │                            │  │  │ │
│  │  │ 📋 الأوامر المعلقة   │  │  │  │    [  حفظ العضو  ]        │  │  │ │
│  │  ├─────────────────────┤  │  │  └────────────────────────────┘  │  │ │
│  │  │ ⚙️ الإعدادات        │  │  │                                  │  │ │
│  │  └─────────────────────┘  │  └──────────────────────────────────┘  │ │
│  └───────────────────────────┴────────────────────────────────────────┘ │
│                                                                          │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │  📊 شريط الحالة: جاري المزامنة... ████████░░ 80%                  │ │
│  └────────────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 📁 هيكل المشروع | Project Structure

```
desktop_software/
├── main.py                 # Entry point
├── config.py               # Configuration settings
├── requirements.txt        # Dependencies
├── build.bat               # Build script for .exe
│
├── core/
│   ├── __init__.py
│   ├── database.py         # .mdb database handler (pyodbc)
│   ├── api_client.py       # Web app API client
│   ├── sync_manager.py     # Sync logic
│   └── file_finder.py      # Find .mdb files on PC
│
├── ui/
│   ├── __init__.py
│   ├── main_window.py      # Main window
│   ├── pages/
│   │   ├── home.py         # Dashboard page
│   │   ├── members.py      # Members list page
│   │   ├── add_member.py   # Add member form
│   │   ├── sync.py         # Sync status page
│   │   ├── commands.py     # Pending commands page
│   │   └── settings.py     # Settings page
│   ├── components/
│   │   ├── sidebar.py      # Side navigation
│   │   ├── status_bar.py   # Bottom status bar
│   │   ├── cards.py        # Status cards
│   │   └── buttons.py      # Styled buttons
│   └── styles.py           # Theme and colors
│
├── assets/
│   ├── logo.png
│   └── icons/
│
└── data/
    └── config.json         # Local config (API key, etc.)
```

---

## 🔧 المتطلبات | Requirements

```txt
# requirements.txt
customtkinter>=5.2.0        # Modern GUI framework
pyodbc>=4.0.39              # Access .mdb database
requests>=2.31.0            # API calls
Pillow>=10.0.0              # Images
pyinstaller>=6.0.0          # Build .exe
```

---

## 🚀 الميزات | Features

### 1. الإعداد الأولي | First Setup

```
┌────────────────────────────────────────────────────────────────┐
│                     🔧 إعداد البرنامج                          │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                                                           │ │
│  │   🔍 جاري البحث عن قاعدة البيانات...                     │ │
│  │   ████████████░░░░░░░░ 60%                                │ │
│  │                                                           │ │
│  │   ✅ تم العثور على:                                       │ │
│  │   📁 C:\AAS\Attendancear\tmkq.mdb (Active)                │ │
│  │   📁 C:\AAS\Attendancear\BackUpData\tmkq.mdb (Backup)     │ │
│  │                                                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │ رابط السيرفر: [https://gymsystem.pythonanywhere.com]     │ │
│  │ مفتاح API:   [________________________________]           │ │
│  │ معرف الفرع:  [1]                                          │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│                    [ بدء المزامنة الأولى ]                     │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

**الخطوات:**
1. البحث في جميع الأقراص عن ملفات `.mdb`
2. تحديد قاعدة البيانات النشطة والنسخة الاحتياطية
3. إدخال بيانات الاتصال (URL, API Key, Brand ID)
4. إرسال جميع الأعضاء الموجودين إلى الويب
5. حفظ الإعدادات محلياً

---

### 2. لوحة التحكم الرئيسية | Dashboard

```
┌────────────────────────────────────────────────────────────────┐
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │    🟢 متصل   │  │   👥 150     │  │   📥 5       │         │
│  │    بالسيرفر  │  │   إجمالي    │  │   أوامر      │         │
│  │              │  │   الأعضاء   │  │   معلقة      │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐         │
│  │   🔄 30 ث    │  │   ✅ 148     │  │   ⚠️ 2       │         │
│  │   فترة       │  │   متزامن    │  │   غير        │         │
│  │   المزامنة   │  │              │  │   متزامن     │         │
│  └──────────────┘  └──────────────┘  └──────────────┘         │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │                  آخر النشاطات                            │ │
│  │  ─────────────────────────────────────────────────────── │ │
│  │  🕐 10:30 - تمت مزامنة 3 أعضاء جدد                       │ │
│  │  🕐 10:29 - تم تنفيذ أمر حظر للعضو #25                   │ │
│  │  🕐 10:28 - تم استقبال heartbeat من السيرفر              │ │
│  │  🕐 10:25 - تمت إضافة عضو جديد: أحمد محمد                │ │
│  └──────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────────┘
```

---

### 3. إضافة عضو جديد | Add New Member

```
┌────────────────────────────────────────────────────────────────┐
│                      ➕ إضافة عضو جديد                         │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │                                                          │ │
│  │   الاسم الكامل *                                         │ │
│  │   ┌──────────────────────────────────────────────────┐  │ │
│  │   │                                                  │  │ │
│  │   └──────────────────────────────────────────────────┘  │ │
│  │                                                          │ │
│  │   رقم الجوال *                                           │ │
│  │   ┌──────────────────────────────────────────────────┐  │ │
│  │   │ 05                                               │  │ │
│  │   └──────────────────────────────────────────────────┘  │ │
│  │                                                          │ │
│  │   الجنس *                        تاريخ انتهاء الاشتراك * │ │
│  │   ┌────────────────┐            ┌────────────────────┐  │ │
│  │   │ ذكر        ▼  │            │ 2026-12-31         │  │ │
│  │   └────────────────┘            └────────────────────┘  │ │
│  │                                                          │ │
│  │   ┌──────────────────────────────────────────────────┐  │ │
│  │   │              💾 حفظ وإضافة البصمة               │  │ │
│  │   └──────────────────────────────────────────────────┘  │ │
│  │                                                          │ │
│  │   ⚠️ بعد الحفظ، سجل بصمة العضو في جهاز البصمة          │ │
│  │      باستخدام الرقم: ________                           │ │
│  │                                                          │ │
│  └──────────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────────┘
```

**عند الحفظ:**
1. إضافة العضو إلى `.mdb` محلياً
2. وضع علامة "غير متزامن"
3. في المزامنة التالية (خلال 30 ثانية) → إرسال للويب
4. تحديث الحالة إلى "متزامن"

---

### 4. المزامنة | Sync Flow

```
┌─────────────────────────────────────────────────────────────────┐
│                        دورة المزامنة (كل 30 ثانية)              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌───────┐ │
│   │ قراءة   │ ───→ │ مقارنة  │ ───→ │ إرسال   │ ───→ │ تنفيذ │ │
│   │ .mdb    │      │ مع الويب │      │ التحديث │      │ الأوامر│ │
│   └─────────┘      └─────────┘      └─────────┘      └───────┘ │
│                                                                  │
│   1. قراءة جميع الأعضاء من .mdb                                 │
│   2. مقارنة مع آخر مزامنة                                       │
│   3. إرسال الأعضاء الجدد/المحدثين للويب                         │
│   4. جلب الأوامر المعلقة من الويب                               │
│   5. تنفيذ الأوامر على .mdb                                     │
│   6. تحديث حالة الأوامر                                         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**أنواع الأوامر من الويب:**
| الأمر | الوصف | التنفيذ على .mdb |
|-------|-------|------------------|
| `block_member` | حظر عضو | `UPDATE Employee SET end_date='2020-01-01' WHERE emp_id=X` |
| `unblock_member` | إلغاء حظر | `UPDATE Employee SET end_date='2026-12-31' WHERE emp_id=X` |
| `update_member` | تحديث بيانات | `UPDATE Employee SET ... WHERE emp_id=X` |
| `add_member` | إضافة عضو | `INSERT INTO Employee ...` |

---

### 5. صفحة الإعدادات | Settings

```
┌────────────────────────────────────────────────────────────────┐
│                         ⚙️ الإعدادات                           │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ إعدادات الاتصال                                          │ │
│  │ ───────────────────────────────────────────────────────── │ │
│  │ رابط السيرفر:                                             │ │
│  │ [https://gymsystem.pythonanywhere.com_______________]     │ │
│  │                                                           │ │
│  │ مفتاح API:                                                │ │
│  │ [****************************************]  [👁️]          │ │
│  │                                                           │ │
│  │ معرف الفرع (Brand ID):                                    │ │
│  │ [1]                                                       │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ إعدادات المزامنة                                          │ │
│  │ ───────────────────────────────────────────────────────── │ │
│  │ فترة المزامنة:  [30] ثانية                                │ │
│  │ ☑️ تشغيل تلقائي عند بدء Windows                           │ │
│  │ ☑️ تشغيل في الخلفية (System Tray)                        │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ قاعدة البيانات                                            │ │
│  │ ───────────────────────────────────────────────────────── │ │
│  │ المسار الحالي:                                            │ │
│  │ C:\AAS\Attendancear\tmkq.mdb                              │ │
│  │ [🔍 البحث عن قاعدة بيانات أخرى]                          │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                 │
│                    [ 💾 حفظ الإعدادات ]                        │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

---

## 📊 مؤشرات الحالة | Status Indicators

```
┌─────────────────────────────────────────────────────────────┐
│                      مؤشرات الحالة                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  🟢 متصل          - الاتصال بالسيرفر نشط                    │
│  🟡 جاري المزامنة  - عملية مزامنة جارية                      │
│  🔴 غير متصل       - فشل الاتصال بالسيرفر                   │
│  🟠 أوامر معلقة    - يوجد أوامر تنتظر التنفيذ               │
│                                                              │
│  أثناء المزامنة:                                             │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  🔄 جاري المزامنة... ████████████░░░░ 75%             │ │
│  │  ↳ إرسال 5 أعضاء جدد...                                │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  عند النجاح:                                                 │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  ✅ تمت المزامنة بنجاح - آخر مزامنة: 10:30:45          │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  عند الفشل:                                                  │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  ❌ فشل الاتصال - سيتم إعادة المحاولة خلال 30 ثانية    │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔐 الأمان | Security

1. **API Key** مخزن محلياً ومشفر
2. **HTTPS** لجميع الاتصالات
3. لا يتم تخزين كلمات مرور الأعضاء
4. سجل نشاطات للتتبع

---

## 📦 بناء الملف التنفيذي | Build .exe

```batch
# build.bat
pyinstaller --onefile --windowed --icon=assets/logo.ico --name="GymBridge" main.py
```

---

## 🔄 تدفق العمل | Workflow

```
┌──────────────────────────────────────────────────────────────────┐
│                         تدفق العمل الكامل                        │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    التثبيت الأول                            │ │
│  │  1. تشغيل البرنامج                                          │ │
│  │  2. البحث التلقائي عن .mdb                                  │ │
│  │  3. إدخال بيانات السيرفر                                    │ │
│  │  4. المزامنة الأولى (إرسال جميع الأعضاء)                    │ │
│  │  5. ✅ جاهز للعمل                                            │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                              ↓                                    │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    العمل اليومي                              │ │
│  │  • إضافة أعضاء جدد من البرنامج                              │ │
│  │  • المزامنة التلقائية كل 30 ثانية                           │ │
│  │  • تنفيذ أوامر الويب (حظر/إلغاء حظر)                        │ │
│  │  • عرض حالة الأعضاء والمزامنة                               │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                              ↓                                    │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                    من الويب                                  │ │
│  │  • إرسال أمر حظر عضو ← البرنامج ينفذ على .mdb               │ │
│  │  • إرسال أمر تحديث ← البرنامج يحدث .mdb                     │ │
│  │  • عرض حالة الأعضاء من الويب                                │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## 📋 خطوات التنفيذ | Implementation Steps

### المرحلة 1: الأساسيات
- [ ] إنشاء هيكل المشروع
- [ ] إعداد customtkinter
- [ ] النافذة الرئيسية والتنقل

### المرحلة 2: قاعدة البيانات
- [ ] البحث عن ملفات .mdb
- [ ] قراءة/كتابة البيانات (pyodbc)
- [ ] معالجة الأخطاء

### المرحلة 3: الاتصال بالويب
- [ ] API Client
- [ ] المزامنة الدورية
- [ ] تنفيذ الأوامر

### المرحلة 4: الواجهة
- [ ] لوحة التحكم
- [ ] إضافة عضو
- [ ] قائمة الأعضاء
- [ ] الإعدادات

### المرحلة 5: البناء
- [ ] اختبار شامل
- [ ] بناء .exe
- [ ] إنشاء المثبت

---

## ✅ جاهز للبدء؟

هل تريد البدء في كتابة الكود الآن؟
