# Deployment Guide - نظام إدارة الجيم

## Railway Deployment

### 1. Prerequisites
- Railway account
- GitHub repository with the code

### 2. Steps

1. **Create New Project**
   - Go to [Railway](https://railway.app)
   - Click "New Project"
   - Select "Deploy from GitHub repo"
   - Connect your repository

2. **Add PostgreSQL Database**
   - Click "+ New"
   - Select "Database" → "PostgreSQL"
   - Railway will auto-create DATABASE_URL

3. **Set Environment Variables**
   ```
   FLASK_ENV=production
   SECRET_KEY=<generate-a-secure-key>
   FINGERPRINT_API_KEY=<generate-api-key>
   ```

4. **Deploy**
   - Railway auto-deploys on push to main branch
   - Monitor logs for any errors

5. **Initialize Database**
   ```bash
   railway run flask db upgrade
   railway run flask create-admin
   ```

### 3. Custom Domain (Optional)
   - Go to Settings → Networking
   - Add custom domain
   - Configure DNS records

---

## Render Deployment

### 1. Prerequisites
- Render account
- GitHub repository

### 2. Steps

1. **Create Web Service**
   - Go to [Render](https://render.com)
   - Click "New +" → "Web Service"
   - Connect GitHub repository
   - Select branch

2. **Configure Service**
   - Name: `gym-system`
   - Runtime: Python 3
   - Build Command: `pip install -r requirements.txt`
   - Start Command: `gunicorn run:app`

3. **Create Database**
   - Click "New +" → "PostgreSQL"
   - Name: `gym-db`
   - Link to web service

4. **Environment Variables**
   ```
   FLASK_ENV=production
   SECRET_KEY=<auto-generated>
   DATABASE_URL=<from-database>
   FINGERPRINT_API_KEY=<generate-key>
   ```

5. **Deploy**
   - Click "Create Web Service"
   - Wait for deployment

---

## Post-Deployment Setup

### 1. Create Admin User
```bash
# Railway
railway run flask create-admin

# Render (use Shell)
flask create-admin
```

### 2. Access Admin Panel
- Go to: `https://your-domain.com/auth/login`
- Login with admin credentials
- Create brands and users

### 3. Configure Bridge Service
On the local gym computer:

1. Copy `bridge_service` folder
2. Edit configuration:
   ```
   GYM_API_URL=https://your-domain.com
   GYM_API_KEY=<your-api-key>
   FINGERPRINT_IP=192.168.1.224
   ```
3. Run bridge service:
   ```bash
   python bridge.py
   ```

---

## Environment Variables Reference

| Variable | Description | Required |
|----------|-------------|----------|
| `FLASK_ENV` | Environment (production/development) | Yes |
| `SECRET_KEY` | Flask secret key | Yes |
| `DATABASE_URL` | PostgreSQL connection string | Yes |
| `FINGERPRINT_API_KEY` | API key for bridge service | Yes |
| `MAX_CONTENT_LENGTH` | Max upload size (default: 16MB) | No |

---

## Troubleshooting

### Database Connection Error
- Verify DATABASE_URL is set correctly
- Check if database is accessible
- Run migrations: `flask db upgrade`

### Static Files Not Loading
- Ensure FLASK_ENV is set
- Check static files path in templates

### Bridge Service Not Syncing
- Verify API_URL and API_KEY
- Check network connectivity
- Review bridge.log for errors

---

## Monitoring

### Railway
- View logs in Railway dashboard
- Set up alerts for errors

### Render
- View logs in Render dashboard
- Enable health checks

---

## Backup

### Database Backup
```bash
# Railway
railway run pg_dump $DATABASE_URL > backup.sql

# Render
# Use Render dashboard or pgAdmin
```

### Restore
```bash
psql $DATABASE_URL < backup.sql
```
